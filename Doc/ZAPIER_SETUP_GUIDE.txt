# Zapier Setup Guide for Process-Lead Function

## Overview
This guide shows how to configure Zapier to send lead data to the Supabase Edge Function `process-lead`.
The function accepts all 40 fields from the leads table.

## Function URL
```
https://yfivkhczzywgttbgwtgr.supabase.co/functions/v1/process-lead
```

## Required Headers
- `Authorization: Bearer [your-anon-key]`
- `Content-Type: application/json`

## Required Field
- `submission_id` (string) - Unique identifier for the lead submission

## All Available Fields

### Core Customer Information
- `submission_id` (string, required) - Unique submission identifier
- `customer_full_name` (string) - Full name of the customer
- `phone_number` (string) - Customer's phone number
- `email` (string) - Customer's email address
- `date_of_birth` (string/date) - Customer's date of birth (YYYY-MM-DD format)
- `age` (number) - Customer's age
- `social_security` (string) - Social security number
- `driver_license` (string) - Driver's license number

### Address Information
- `street_address` (string) - Street address
- `city` (string) - City
- `state` (string) - State
- `zip_code` (string) - ZIP code
- `birth_state` (string) - State of birth

### Accident/Incident Details
- `accident_date` (string/date) - Date of accident (YYYY-MM-DD format)
- `accident_location` (string) - Location where accident occurred
- `accident_scenario` (string) - Description of what happened
- `injuries` (string) - Description of injuries sustained
- `medical_attention` (string) - Medical treatment received
- `police_attended` (boolean/string) - Whether police attended (true/false or "true"/"false")
- `insured` (boolean/string) - Whether the customer was insured (true/false or "true"/"false")
- `vehicle_registration` (string) - Customer's vehicle registration number
- `insurance_company` (string) - Insurance company name
- `third_party_vehicle_registration` (string) - Other party's vehicle registration
- `other_party_admit_fault` (boolean/string) - Whether other party admitted fault
- `passengers_count` (number) - Number of passengers in vehicle

### Legal/Contact Information
- `prior_attorney_involved` (boolean/string) - Whether prior attorney was involved
- `prior_attorney_details` (string) - Details about prior attorney involvement
- `contact_name` (string) - Witness or contact person name
- `contact_number` (string) - Witness or contact person phone
- `contact_address` (string) - Witness or contact person address

### Business Fields
- `lead_vendor` (string) - Source/vendor of the lead
- `buffer_agent` (string) - Assigned buffer agent
- `agent` (string) - Assigned agent
- `additional_notes` (string) - Any additional notes

## Zapier Setup Steps

### 1. Create a New Zap
- Go to Zapier and create a new Zap
- Choose your trigger (e.g., Webhook, Form submission, etc.)

### 2. Add Code by Zapier Action
- Add "Code by Zapier" as the action step
- Choose "Run JavaScript" as the action event

### 3. Configure the Code Step
Use this JavaScript code in the Code by Zapier step:

```javascript
// Get data from previous step (adjust inputData based on your trigger)
const leadData = {
  // Required field
  submission_id: inputData.submission_id || inputData.id || Date.now().toString(),

  // Customer Information
  customer_full_name: inputData.customer_full_name || inputData.name || '',
  phone_number: inputData.phone_number || inputData.phone || '',
  email: inputData.email || '',

  // Personal Details
  date_of_birth: inputData.date_of_birth || inputData.dob || null,
  age: inputData.age ? parseInt(inputData.age) : null,
  social_security: inputData.social_security || inputData.ssn || '',
  driver_license: inputData.driver_license || inputData.license || '',

  // Address
  street_address: inputData.street_address || inputData.address || '',
  city: inputData.city || '',
  state: inputData.state || '',
  zip_code: inputData.zip_code || inputData.zip || '',
  birth_state: inputData.birth_state || '',

  // Accident Details
  accident_date: inputData.accident_date || null,
  accident_location: inputData.accident_location || '',
  accident_scenario: inputData.accident_scenario || inputData.description || '',
  injuries: inputData.injuries || '',
  medical_attention: inputData.medical_attention || '',
  police_attended: inputData.police_attended === 'true' || inputData.police_attended === true,
  insured: inputData.insured === 'true' || inputData.insured === true,
  vehicle_registration: inputData.vehicle_registration || '',
  insurance_company: inputData.insurance_company || '',
  third_party_vehicle_registration: inputData.third_party_vehicle_registration || '',
  other_party_admit_fault: inputData.other_party_admit_fault === 'true' || inputData.other_party_admit_fault === true,
  passengers_count: inputData.passengers_count ? parseInt(inputData.passengers_count) : null,

  // Legal/Contact
  prior_attorney_involved: inputData.prior_attorney_involved === 'true' || inputData.prior_attorney_involved === true,
  prior_attorney_details: inputData.prior_attorney_details || '',
  contact_name: inputData.contact_name || inputData.witness_name || '',
  contact_number: inputData.contact_number || inputData.witness_phone || '',
  contact_address: inputData.contact_address || inputData.witness_address || '',

  // Business
  lead_vendor: inputData.lead_vendor || inputData.source || '',
  buffer_agent: inputData.buffer_agent || '',
  agent: inputData.agent || '',
  additional_notes: inputData.additional_notes || inputData.notes || ''
};

// Make HTTP request to Supabase function
const response = await fetch('https://yfivkhczzywgttbgwtgr.supabase.co/functions/v1/process-lead', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmaXZraGN6enl3Z3R0Ymd3dGdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzA3NDYsImV4cCI6MjA3OTg0Njc0Nn0.ZcjrAzL2JFSRXXuTux3XZXl-cX0hhUAvIxeBdtWV4cE',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(leadData)
});

const result = await response.json();

// Return the result for next steps in Zap
return result;
```

### 4. Test the Zap
- Test the Code by Zapier step
- Verify the lead is created in your Supabase database

## Alternative: Web Parser by Zapier

If you prefer not to use Code by Zapier, you can use "Web Parser by Zapier":

1. Add "Web Parser by Zapier" action
2. Choose "POST" as the method
3. Enter the function URL: `https://yfivkhczzywgttbgwtgr.supabase.co/functions/v1/process-lead`
4. Add headers:
   - `Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmaXZraGN6enl3Z3R0Ymd3dGdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzA3NDYsImV4cCI6MjA3OTg0Njc0Nn0.ZcjrAzL2JFSRXXuTux3XZXl-cX0hhUAvIxeBdtWV4cE`
   - `Content-Type: application/json`
5. In the Data section, map all your fields to the corresponding JSON structure

## Sample JSON Payload

```json
{
  "submission_id": "LEAD-2025-001",
  "customer_full_name": "John Doe",
  "phone_number": "+1-555-123-4567",
  "email": "john.doe@example.com",
  "date_of_birth": "1985-06-15",
  "age": 40,
  "social_security": "123-45-6789",
  "driver_license": "D123456789",
  "street_address": "123 Main Street",
  "city": "Anytown",
  "state": "CA",
  "zip_code": "12345",
  "birth_state": "NY",
  "accident_date": "2025-11-15",
  "accident_location": "Highway 101, Mile 45",
  "accident_scenario": "Rear-end collision at stop light",
  "injuries": "Whiplash, neck strain",
  "medical_attention": "Visited urgent care, prescribed pain medication",
  "police_attended": true,
  "insured": true,
  "vehicle_registration": "ABC-123-XYZ",
  "insurance_company": "State Farm",
  "third_party_vehicle_registration": "DEF-456-UVW",
  "other_party_admit_fault": false,
  "passengers_count": 1,
  "prior_attorney_involved": false,
  "prior_attorney_details": "",
  "contact_name": "Jane Smith",
  "contact_number": "+1-555-987-6543",
  "contact_address": "456 Witness Ave, Anytown, CA 12345",
  "lead_vendor": "AccidentClaims.com",
  "buffer_agent": "",
  "agent": "",
  "additional_notes": "Customer called about rear-end accident, seeking compensation"
}
```

## Testing with cURL

```bash
curl -L -X POST 'https://yfivkhczzywgttbgwtgr.supabase.co/functions/v1/process-lead' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmaXZraGN6enl3Z3R0Ymd3dGdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzA3NDYsImV4cCI6MjA3OTg0Njc0Nn0.ZcjrAzL2JFSRXXuTux3XZXl-cX0hhUAvIxeBdtWV4cE' \
  -H 'Content-Type: application/json' \
  --data '{
    "submission_id": "TEST-LEAD-001",
    "customer_full_name": "Test Customer",
    "phone_number": "+1-555-123-4567",
    "email": "test@example.com",
    "accident_date": "2025-11-15",
    "accident_location": "Test Location",
    "police_attended": true,
    "insured": true
  }'
```

## Notes
- All fields are optional except `submission_id`
- Boolean fields accept both boolean values (true/false) and strings ("true"/"false")
- Date fields should be in YYYY-MM-DD format
- The function will automatically handle missing fields with appropriate defaults
- Duplicate submissions with the same `submission_id` will be rejected